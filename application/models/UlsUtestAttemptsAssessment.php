<?php

/**
 * UlsUtestAttemptsAssessment
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    ##PACKAGE##
 * @subpackage ##SUBPACKAGE##
 * @author     ##NAME## <##EMAIL##>
 * @version    SVN: $Id: Builder.php 6820 2009-11-30 17:27:49Z jwage $
 */
class UlsUtestAttemptsAssessment extends BaseUlsUtestAttemptsAssessment
{
	function preInsert($event){
		$CI =& get_instance();
		$CI->load->library('session');
        $this->created_by=$CI->session->userdata('username');
        $this->created_date=date('Y-m-d');
        $this->modified_by=$CI->session->userdata('username');        
        $this->modified_date=date('Y-m-d');
        $this->last_modified_id=$CI->session->userdata('user_id');
        $this->parent_org_id=$CI->session->userdata('parent_org_id');
    }
	
    function preUpdate($event){
		$CI =& get_instance();
		$CI->load->library('session');
        $this->modified_date=date('Y-m-d');
        $this->modified_by=$CI->session->userdata('username');
        $this->last_modified_id=$CI->session->userdata('user_id');
    }
	
	/* static public function getattemptvalus($ass_id,$empid,$ass_test_id,$pre){	 
		echo $dsd=Doctrine_Query::Create()->select('attempt_status,correct_ans,wrong_ans,score')->from('UlsUtestAttemptsAssessment')->where('employee_id='.$empid.' and test_type='.$pre.' and assessment_id='.$ass_id.' and event_id='.$ass_test_id)->orderBy('attempt_id desc')->limit(1)->getsqlquery();
		return $dsd;
	} */
	
	static function getattemptvalus($ass_id,$empid,$ass_test_id,$pre){
		
		$query="Select a.* from uls_utest_attempts_assessment a
		where a.employee_id=".$empid." and status='A' and test_type='".$pre."' and assessment_id=".$ass_id." and event_id=".$ass_test_id."";
		$details=UlsMenu::callpdorow($query);
		return $details;
	}
	
	static function getattempttest($ass_id,$ass_test_id,$test,$emp){
		$query=" Select a.* from uls_utest_attempts_assessment a
		where a.`assessment_id`=".$ass_id." and a.event_id=".$ass_test_id." and a.test_id=".$test." and a.employee_id=".$emp;
		$details=UlsMenu::callpdo($query);
		return $details;
	}
	
	static function getattemptvalus_interview($ass_id,$empid,$ass_test_id,$pre){
		$query="Select a.* from uls_utest_attempts_assessment a
		where a.employee_id=".$empid." and test_type='".$pre."' and assessment_id=".$ass_id." and event_id=".$ass_test_id." and a.assessor_id=".$_SESSION['asr_id']."";
		$details=UlsMenu::callpdorow($query);
		return $details;
	}
	
	/* static public function getattemptvalus_inbasket($ass_id,$empid,$ass_test_id,$pre,$test_id){	 
		$dsd=Doctrine_Query::Create()->select('attempt_status,correct_ans,wrong_ans,score,attempt_id')->from('UlsUtestAttemptsAssessment')->where('employee_id='.$empid.' and test_type='.$pre.' and assessment_id='.$ass_id.' and event_id='.$ass_test_id.' and test_id='.$test_id)->orderBy('attempt_id desc')->limit(1)->getsqlquery();
		return $dsd;
	} */
	
	static function getattemptvalus_inbasket($ass_id,$empid,$ass_test_id,$pre,$test_id){
		$query=" Select a.attempt_status,a.correct_ans,a.wrong_ans,a.score,a.attempt_id,a.start_period,a.end_period,a.inbasket_upload from uls_utest_attempts_assessment a
		where a.employee_id=".$empid." and test_type='".$pre."' and assessment_id=".$ass_id." and event_id=".$ass_test_id." and test_id=".$test_id;
		$details=UlsMenu::callpdorow($query);
		return $details;
	}
	
	/* static public function attempt_details($attempt_id,$test_id,$emp_id){	 
		$dsd=Doctrine_Query::Create()->select('attempt_status,correct_ans,wrong_ans,score,attempt_id,assessment_id,event_id,test_id,test_type')->from('UlsUtestAttemptsAssessment')->where("employee_id=".$emp_id." and status='A' and attempt_id=".$attempt_id." and test_id=".$test_id)->orderBy('attempt_id desc')->limit(1)->fetchOne();
		return $dsd;
	} */
	
	static function attempt_details($attempt_id,$test_id,$emp_id){
		$query=" Select a.attempt_status,a.correct_ans,a.wrong_ans,a.score,a.attempt_id,a.assessment_id,a.event_id,a.test_id,a.test_type from uls_utest_attempts_assessment a
		where a.employee_id=".$emp_id."  and status='A' and attempt_id=".$attempt_id." and test_id=".$test_id;
		$details=UlsMenu::callpdorow($query);
		return $details;
	}
	
	static public function gettestasstest($ass_id,$emp_id){
		$query="SELECT * FROM `uls_utest_attempts_assessment` WHERE `employee_id`='$emp_id' and `assessment_id`='$ass_id' and `status`='A' and `test_type`='TEST'";
		$details=UlsMenu::callpdorow($query);
		return $details;
	}
	
	static function get_score_value_max($ass_id){
		$query="Select max(a.score) as max_score from uls_utest_attempts_assessment a
		where a.test_type='TEST' and a.assessment_id in (".$ass_id.")";
		$details=UlsMenu::callpdorow($query);
		return $details;
	}
	
	static public function attempt_detail_report($event_id,$emp_id){	 
		$dsd=Doctrine_Query::Create()->select('attempt_status,correct_ans,wrong_ans,score,attempt_id,assessment_id,event_id,test_id,test_type')->from('UlsUtestAttemptsAssessment')->where('employee_id='.$emp_id.' and event_id='.$event_id)->orderBy('attempt_id desc')->limit(1)->fetchOne();
		return $dsd;
	}
}