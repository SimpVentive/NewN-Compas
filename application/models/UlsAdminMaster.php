<?php

/**
 * UlsAdminMaster
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    ##PACKAGE##
 * @subpackage ##SUBPACKAGE##
 * @author     ##NAME## <##EMAIL##>
 * @version    SVN: $Id: Builder.php 6820 2009-11-30 17:27:49Z jwage $
 */
class UlsAdminMaster extends BaseUlsAdminMaster
{
	function preInsert($event){
		$CI =& get_instance();
		$CI->load->library('session');
		$this->created_by=$CI->session->userdata('username');
		$this->created_date=date('Y-m-d');
		$this->modified_by=$CI->session->userdata('username');        
		$this->modified_date=date('Y-m-d');
		$this->last_modified_id=$CI->session->userdata('user_id');
        $this->parent_org_id=$CI->session->userdata('parent_org_id');
	}
	
	function preUpdate($event){
		$CI =& get_instance();
		$CI->load->library('session');
		$this->modified_date=date('Y-m-d');
		$this->modified_by=$CI->session->userdata('username');
		$this->last_modified_id=$CI->session->userdata('user_id');
	}
	
	public static function secure_employee_master_values(){
		$CI =& get_instance();
		$CI->load->library('session');
		$security_org_id=$CI->session->userdata('security_org_id');
		$security_location_id=$CI->session->userdata('security_location_id');
		if(!empty($security_org_id) && !empty($security_location_id)){
			if($CI->session->userdata('security_type')=='no'){
				if(!empty($security_location_id)){
					$emp_parent="";
				}else{
					$emp_parent="";
				}
			}else{
				if(!empty($security_location_id)){
					$sql=" and location_id in (".$CI->session->userdata('security_location_id').")";
					$emp_data="select zone_id  FROM employee_data where status='A' and employee_id='".$CI->session->userdata('emp_id')."' $sql ";        
					$emp_parents=UlsMenu::callpdorow($emp_data);
					$emp_parent=$emp_parents['zone_id'];
				}
			}
			
			$empid=$emp_parent;
			return $empid;
		}
	}
	
	static function organizationtypes(){
		$query = UlsMenu::callpdo("select mc.master_code, mv.* from uls_admin_master mc, uls_admin_values mv where mc.master_code='ORG_TYPE' and mc.master_code=mv.master_code");
		return $query;
	}
	
	public static function get_value_names($year_code){
		$query = UlsMenu::callpdo("select mc.master_code, mv.value_code as code, mv.value_name as name from uls_admin_master mc, uls_admin_values mv where mc.master_code='".$year_code."' and mc.master_code=mv.master_code and (CURDATE() between mv.start_date and mv.end_date or (mv.start_date is null or mv.end_date is null))");
		return $query;                
	}
	
	public static function get_value_names_comp($year_code){
		$query = UlsMenu::callpdo("select mc.master_code, mv.value_code as code, mv.value_name as name,mv.value_id as id from uls_admin_master mc, uls_admin_values mv where mc.master_code='".$year_code."' and mc.master_code=mv.master_code and mv.parent_org_id=0 and (CURDATE() between mv.start_date and mv.end_date or (mv.start_date is null or mv.end_date is null))");
		return $query;                
	}
	
	public static function get_value_names_comp_sub($year_code,$par_id){
		
		$query = UlsMenu::callpdo("select mc.master_code, mv.value_code as code, mv.value_name as name,mv.value_id as id from uls_admin_master mc, uls_admin_values mv where mc.master_code='".$year_code."' and mc.master_code=mv.master_code and mv.parent_org_id=".$par_id." and (CURDATE() between mv.start_date and mv.end_date or (mv.start_date is null or mv.end_date is null))");
		return $query;                
	}
	
	public static function get_value_names_zones($year_code){
		$emp_masters=UlsAdminMaster::secure_employee_master_values();
		$sq="";
		$sq.=!empty($emp_masters)?" and value_code='".$emp_masters."'":"";
		$query = UlsMenu::callpdo("select mc.master_code, mv.value_code as code, mv.value_name as name from uls_admin_master mc, uls_admin_values mv where mc.master_code='".$year_code."' ".$sq."  and mc.master_code=mv.master_code and (CURDATE() between mv.start_date and mv.end_date or (mv.start_date is null or mv.end_date is null))");
		return $query;                
	}
	
	public static function get_value_names_limit($year_code){
		$query = UlsMenu::callpdo("select mc.master_code, mv.value_code as code, mv.value_name as name from uls_admin_master mc, uls_admin_values mv where mc.master_code='".$year_code."' and mc.master_code=mv.master_code and (CURDATE() between mv.start_date and mv.end_date or (mv.start_date is null or mv.end_date is null)) and mv.value_code in('PAS','FAI')");
		return $query;                
	}
	
	//To get value names based on maste code
	public static function get_value_names_status($status){
		$query = UlsMenu::callpdo("select mc.master_code, mv.value_code as code, mv.value_name as name from uls_admin_master mc, uls_admin_values mv where mc.master_code='".$status."' and mc.master_code=mv.master_code");
		return $query;
	}
	
	static function searchcount($master_code){
		$sq=!empty($master_code)?  " and master_code like '%".$master_code."%'":"";
		$masterlist= Doctrine_Query::create()->select("count(*) as numcount")->from("UlsAdminMaster")->where("1".$sq)->setHydrationMode(Doctrine::HYDRATE_ARRAY)->fetchOne();
		return $masterlist['numcount'];
	}
	
	static function search($start, $limit,$master_code){
		$sq=!empty($master_code)?  " and master_code like '%".$master_code."%'":"";
		$masterlist= Doctrine_Query::create()->from("UlsAdminMaster")->where("1".$sq)->limit($limit)->offset($start)->setHydrationMode(Doctrine::HYDRATE_ARRAY)->execute();
		return $masterlist;
	}
	
	static function view_masters(){
		if(isset($_REQUEST['master_id'])){
		   $mastr_data=Doctrine_Query::create()->from('UlsAdminMaster a')->leftjoin('a.UlsAdminValues')->where("a.master_id=".$_REQUEST['master_id'])->setHydrationMode(Doctrine::HYDRATE_ARRAY)->execute();
		   return $mastr_data;
		}
	}
	
	// for category        
	static function get_value_names_catg($cat_type){
		$query = UlsMenu::callpdo("select mc.Master_code, mv.* from uls_admin_master mc, uls_admin_values mv where mc.Master_code='$cat_type' and mc.Master_code=mv.Master_code and mv.value_code!='PC' and (mv.End_date>=CURDATE() or mv.End_date is null )");
		return $query;
	}
	
	static function get_catg($cat_type){
		$query = UlsMenu::callpdo("select mc.Master_code, mv.* from uls_admin_master mc, uls_admin_values mv where mc.Master_code='$cat_type' and mc.Master_code=mv.Master_code and mv.value_code='PC' and (mv.End_date>=CURDATE() or mv.End_date is null)");
		return $query;
    }
	
	//wrriten by sravanthi
	static function get_value_names_statuss($status1){
		$query = UlsMenu::callpdo("select mc.master_code, mv.value_code as code, mv.value_name as name from uls_admin_master mc, uls_admin_values mv where mc.master_code='".$status1."' and mc.master_code=mv.master_code and mv.value_code in ('NOS','ATT')");
		return $query;
	}
	
	static function get_value_name_statuss($master_code,$value_code){
		$query = UlsMenu::callpdorow("select mv.value_code as code, mv.value_name as name from uls_admin_values mv where mv.master_code='".$master_code."' and mv.value_code='".$value_code."'");
		return $query;
	}
	
	public static function get_value_names_tni($year_code){
		$query = UlsMenu::callpdo("select mc.master_code, mv.value_code as code, mv.value_name as name from uls_admin_master mc, uls_admin_values mv where mc.master_code='".$year_code."' and mc.master_code=mv.master_code and (CURDATE() between mv.start_date and mv.end_date or (mv.start_date is null or mv.end_date is null)) order by mv.value_code DESC");
		return $query;                
	}
}