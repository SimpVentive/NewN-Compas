<?php

/**
 * UlsSelfAssessmentReport
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    ##PACKAGE##
 * @subpackage ##SUBPACKAGE##
 * @author     ##NAME## <##EMAIL##>
 * @version    SVN: $Id: Builder.php 6820 2009-11-30 17:27:49Z jwage $
 */
class UlsSelfAssessmentReport extends BaseUlsSelfAssessmentReport
{
	function preInsert($event){
		$CI =& get_instance();
		$CI->load->library('session');
        $this->created_by=$CI->session->userdata('username');
        $this->created_date=date('Y-m-d');
        $this->modified_by=$CI->session->userdata('username');        
        $this->modified_date=date('Y-m-d');
        $this->last_modified_by=$CI->session->userdata('user_id');
        $this->parent_org_id=$CI->session->userdata('parent_org_id');
    }
	
    function preUpdate($event){
		$CI =& get_instance();
		$CI->load->library('session');
        $this->modified_date=date('Y-m-d');
        $this->modified_by=$CI->session->userdata('username');
        $this->last_modified_by=$CI->session->userdata('user_id');
    }
	
	static function getselfassessment_comp_details($id,$pos_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id) && is_numeric($id)){
			$query="SELECT c.category_id,c.name FROM `uls_self_assessment_competencies` a
			left join(SELECT `comp_def_id`,`comp_def_name`,`comp_def_category` FROM `uls_competency_definition`) b on a.	assessment_pos_com_id=b.comp_def_id
			left join(SELECT `category_id`,`name` FROM `uls_category`) c on b.comp_def_category=c.category_id
			where a.parent_org_id=".$CI->session->userdata('parent_org_id')."  and a.assessment_id=".$id." and a.position_id=".$pos_id." group by b.comp_def_category ";
			$compdef=UlsMenu::callpdo($query);
		}
		return $compdef;
	}
	
	static function getselfassessment_competencies_summary($id,$pos_id,$emp_id,$cat_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id) && is_numeric($id)){
			$query="SELECT ac.`assessment_id`,ac.`assessment_pos_com_id`,ac.`assessment_pos_level_id`,ac.`assessment_pos_level_scale_id`,b.comp_def_id,b.comp_def_name,s.scale_name,s.scale_id,a.assessed_scale_id,a.self_report_id,a.strengths,a.knowledge_skill,a.method,a.org_support,a.target_date,a.comp_evidence FROM `uls_self_assessment_competencies` ac 
			left join (select comp_def_id,comp_def_name,comp_def_category from uls_competency_definition group by comp_def_id)b on b.comp_def_id=ac.assessment_pos_com_id
			left join (select scale_id,scale_name from uls_level_master_scale group by scale_id)s on s.scale_id=ac.assessment_pos_level_scale_id
			left join(select self_report_id,assessment_id,position_id,employee_id,competency_id,require_scale_id,assessed_scale_id,strengths,knowledge_skill,method,org_support,target_date,comp_evidence  from uls_self_assessment_report where employee_id=$emp_id ) a on a.assessment_id=ac.assessment_id and a.competency_id=ac.assessment_pos_com_id
			where 1 and ac.parent_org_id=".$CI->session->userdata('parent_org_id')." and b.comp_def_category=".$cat_id."  and ac.assessment_id=$id and ac.position_id=$pos_id order by ac.assessment_id asc";
			$compdef=UlsMenu::callpdo($query);
		}
		return $compdef;
	}
	
	static function getself_assessment_competencies_full_summary($id,$pos_id,$emp_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id) && is_numeric($id)){
			$query="SELECT ac.`assessment_id`,ac.`assessment_pos_com_id`,ac.`assessment_pos_level_id`,ac.`assessment_pos_level_scale_id`,b.comp_def_id,b.comp_def_name,s.scale_name,s.scale_id,a.assessed_scale_id,a.self_report_id FROM `uls_assessment_competencies` ac 
			left join (select comp_def_id,comp_def_name from uls_competency_definition group by comp_def_id)b on b.comp_def_id=ac.assessment_pos_com_id
			left join (select scale_id,scale_name from uls_level_master_scale group by scale_id)s on s.scale_id=ac.assessment_pos_level_scale_id
			left join(select self_report_id,assessment_id,position_id,employee_id,competency_id,require_scale_id,assessed_scale_id  from uls_self_assessment_report where employee_id=$emp_id ) a on a.assessment_id=ac.assessment_id and a.competency_id=ac.assessment_pos_com_id
			where 1 and ac.parent_org_id=".$CI->session->userdata('parent_org_id')."  and ac.assessment_id=$id and ac.position_id=$pos_id order by ac.assessment_id asc";
			$compdef=UlsMenu::callpdo($query);
		}
		return $compdef;
	}
	
	static function getassessment_self_admin_summary($id,$pos_id,$emp_id,$cat_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id) && is_numeric($id)){
			$query="select b.comp_def_id, b.comp_def_name as comp_def_name,s.scale_id as req_scale_id, s.scale_name as req_scale_name,a.self_report_id,a.assessed_scale_id as final_scaled_id,ass.scale_name as final_scaled_name, a.* ,s.scale_number as req_number,ass.scale_number as ass_number,ct.comp_cri_name,ct.comp_rating_value,b.comp_def_short_desc,l.level_scale,ct.comp_cri_code from uls_self_assessment_report a
			left join (select comp_def_id,comp_def_name,comp_def_short_desc,comp_def_category from uls_competency_definition group by comp_def_id)b on b.comp_def_id=a.competency_id
			left join(SELECT `comp_position_id`,`comp_position_competency_id`,`comp_position_criticality_id` FROM `uls_competency_position_requirements`) c on c.comp_position_id=a.position_id and c.comp_position_competency_id=a.competency_id
			left join(SELECT `comp_cri_id`,`comp_cri_name`,comp_rating_value,comp_cri_code FROM `uls_competency_criticality`) ct on ct.comp_cri_id=c.comp_position_criticality_id
			left join (select scale_id,scale_name,scale_number,level_id from uls_level_master_scale group by scale_id)s on s.scale_id=a.require_scale_id
			left join(SELECT `level_id`,`level_scale` FROM `uls_level_master`) l on l.level_id=s.level_id
			left join (select scale_id,scale_name,scale_number from uls_level_master_scale group by scale_id)ass on ass.scale_id=a.assessed_scale_id
			where 1 and a.parent_org_id=".$CI->session->userdata('parent_org_id')." and a.assessment_id=$id and a.position_id=$pos_id and a.employee_id=$emp_id and b.comp_def_category=".$cat_id." order by b.comp_def_name asc";
			$compdef=UlsMenu::callpdo($query);
		}
		return $compdef;
	}
	
	static function getadminselfassessment_competencies_insert($id,$pos_id,$emp_id,$assessor_id,$comp_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id) && is_numeric($id)){
			$query="select a.* from uls_self_assessment_report a
			where 1 and a.parent_org_id=".$CI->session->userdata('parent_org_id')." and a.assessment_id=$id and a.position_id=$pos_id and a.employee_id=$emp_id and competency_id=$comp_id and a.final_admin_id=".$assessor_id." order by a.assessment_id asc";
			$compdef=UlsMenu::callpdorow($query);
		}
		return $compdef;
	}
	
	static function getadminselfrating_count($id,$pos_id,$emp_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id) && is_numeric($id)){
			$query="select a.* from uls_self_assessment_report a
			where 1 and a.parent_org_id=".$CI->session->userdata('parent_org_id')." and a.assessment_id=$id and a.position_id=$pos_id and a.employee_id=$emp_id";
			$compdef=UlsMenu::callpdo($query);
		}
		return $compdef;
	}
	
	static function getassessment_self_category($id,$pos_id,$emp_id,$cat_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id) && is_numeric($id)){
			$query="select b.comp_def_id, b.comp_def_name as comp_def_name,a.self_report_id,a.assessed_scale_id as final_scaled_id, a.*,b.comp_def_short_desc from uls_self_assessment_report a
			left join (select comp_def_id,comp_def_name,comp_def_short_desc,comp_def_category from uls_competency_definition group by comp_def_id)b on b.comp_def_id=a.competency_id
			where 1 and a.parent_org_id=".$CI->session->userdata('parent_org_id')." and a.assessment_id=$id and a.position_id=$pos_id and a.employee_id=$emp_id and b.comp_def_category=".$cat_id." and a.strengths='Y'  order by b.comp_def_name asc LIMIT 3";
			$compdef=UlsMenu::callpdo($query);
		}
		return $compdef;
	}
	
	static function getassessment_self_competency($id,$pos_id,$emp_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id) && is_numeric($id)){
			$query="select b.comp_def_id, b.comp_def_name as comp_def_name,a.self_report_id,a.assessed_scale_id as final_scaled_id, a.*,b.comp_def_short_desc,c.value_name as method_value_name,s.scale_name,d.value_name as strength_value_name from uls_self_assessment_report a
			left join (select comp_def_id,comp_def_name,comp_def_short_desc,comp_def_category from uls_competency_definition group by comp_def_id)b on b.comp_def_id=a.competency_id
			left join (select scale_id,scale_name,scale_number,level_id from uls_level_master_scale group by scale_id)s on s.scale_id=a.assessed_scale_id
			LEFT JOIN (SELECT value_id, master_code, value_code, value_name FROM uls_admin_values GROUP BY value_id)c ON c.master_code = 'DEV_METHOD' AND a.method = c.value_code
			LEFT JOIN (SELECT value_id, master_code, value_code, value_name FROM uls_admin_values GROUP BY value_id)d ON d.master_code = 'YES_NO' AND a.strengths = d.value_code
			where 1 and a.parent_org_id=".$CI->session->userdata('parent_org_id')." and a.assessment_id=$id and a.position_id=$pos_id and a.employee_id=$emp_id order by b.comp_def_name asc";
			$compdef=UlsMenu::callpdo($query);
		}
		return $compdef;
	}
	
	
}