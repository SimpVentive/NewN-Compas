<?php

/**
 * UlsCompetencyPositionRequirements
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    ##PACKAGE##
 * @subpackage ##SUBPACKAGE##
 * @author     ##NAME## <##EMAIL##>
 * @version    SVN: $Id: Builder.php 6820 2009-11-30 17:27:49Z jwage $
 */
class UlsCompetencyPositionRequirements extends BaseUlsCompetencyPositionRequirements
{
	function preInsert($event){
		$CI =& get_instance();
		$CI->load->library('session');
		$this->created_by=$CI->session->userdata('username');
		$this->created_date=date('Y-m-d');
		$this->modified_by=$CI->session->userdata('username');        
		$this->modified_date=date('Y-m-d');
		$this->last_modified_id=$CI->session->userdata('user_id');
	}

	function preUpdate($event){
		$CI =& get_instance();
		$CI->load->library('session');
		$this->modified_date=date('Y-m-d');
		$this->modified_by=$CI->session->userdata('username');
		$this->last_modified_id=$CI->session->userdata('user_id');
	}
	
	static function get_competency_req_details($id){
        $comlevel=Doctrine_Query::Create()->select('*')->from('UlsCompetencyPositionRequirements')->where('comp_position_req_id='.$id)->fetchOne();
        return $comlevel;
	}
	
	static function get_competency_position_details($id){
        $comlevel=Doctrine_Query::Create()->select('*')->from('UlsCompetencyPositionRequirements')->where('comp_position_id='.$id)->execute();
        return $comlevel;
	}
	
	static function getcompetencypositionqb($id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id) && is_numeric($id)){
			$query="SELECT b.*,a.* FROM `uls_questionbank` a
			left join (SELECT count(*) as qcount,`question_bank_id`,`level_id`,`scale_id` FROM `uls_questions` group by question_bank_id,scale_id)b on a.`question_bank_id`=b.`question_bank_id`
			WHERE `comp_def_id` in (SELECT `comp_position_competency_id` FROM `uls_competency_position_requirements` WHERE `comp_position_id`=$id )";
			$compdef=UlsMenu::callpdo($query);
		}
		return $compdef;
	}
	
	static function getcompetencypositionqb_ass($id,$comp_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id) && is_numeric($id)){
			$query="SELECT b.*,a.* FROM `uls_questionbank` a
			left join (SELECT count(*) as qcount,`question_bank_id`,`level_id`,`scale_id` FROM `uls_questions` group by question_bank_id,scale_id)b on a.`question_bank_id`=b.`question_bank_id`
			WHERE `comp_def_id` in (SELECT `comp_position_competency_id` FROM `uls_competency_position_requirements` WHERE `comp_position_id`=$id and  comp_position_competency_id=$comp_id)";
			$compdef=UlsMenu::callpdo($query);
		}
		return $compdef;
	}
	
	static function category_comp_details($pos_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($pos_id) && is_numeric($pos_id)){
			$query="SELECT c.category_id,c.name FROM `uls_competency_position_requirements` a
			left join(SELECT `comp_def_id`,`comp_def_name`,`comp_def_category`,parent_org_id FROM `uls_competency_definition`) b on a.	comp_position_competency_id=b.comp_def_id
			left join(SELECT `category_id`,`name` FROM `uls_category`) c on b.comp_def_category=c.category_id
			where b.parent_org_id=".$CI->session->userdata('parent_org_id')."  and a.comp_position_id=".$pos_id." group by b.comp_def_category ";
			$compdef=UlsMenu::callpdo($query);
		}
		return $compdef;
	}
	
	static function getcompetencypositionrequirements_cat($id,$cat_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id) && is_numeric($id)){
			$query="select b.comp_def_id,b.comp_def_name as comp_def_name,c.level_name as level_name, d.scale_name as scale_name,d.scale_id, f.comp_cri_name,f.comp_cri_id,b.comp_def_name_alt, a.* from uls_competency_position_requirements a
			left join (select comp_def_id,comp_def_name,comp_def_category,comp_def_name_alt from uls_competency_definition group by comp_def_id)b on b.comp_def_id=a.comp_position_competency_id
			left join (select level_id,level_name from uls_level_master group by level_id)c on c.level_id=a.comp_position_level_id
			left join (select scale_id,scale_name from uls_level_master_scale group by scale_id)d on d.scale_id=a.comp_position_level_scale_id
			left join (select comp_cri_id,comp_cri_name from uls_competency_criticality group by comp_cri_id)f on f.comp_cri_id=a.comp_position_criticality_id
			where 1 and a.comp_position_id=$id and b.comp_def_category=".$cat_id." order by a.comp_position_id asc";
			$compdef=UlsMenu::callpdo($query);
		}
		return $compdef;
	}
	
	static function getcompetencypositionrequirements($id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id) && is_numeric($id)){
			$query="select b.comp_def_id,b.comp_def_name as comp_def_name,c.level_name as level_name, d.scale_name as scale_name,d.scale_id, f.comp_cri_name,f.comp_cri_id, a.* from uls_competency_position_requirements a
			left join (select comp_def_id,comp_def_name from uls_competency_definition group by comp_def_id)b on b.comp_def_id=a.comp_position_competency_id
			left join (select level_id,level_name from uls_level_master group by level_id)c on c.level_id=a.comp_position_level_id
			left join (select scale_id,scale_name from uls_level_master_scale group by scale_id)d on d.scale_id=a.comp_position_level_scale_id
			left join (select comp_cri_id,comp_cri_name from uls_competency_criticality group by comp_cri_id)f on f.comp_cri_id=a.comp_position_criticality_id
			where 1 and a.comp_position_id=$id order by a.comp_position_id asc";
			$compdef=UlsMenu::callpdo($query);
		}
		return $compdef;
	}
	
	static function competencypositionrequirement_details($id,$aid){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id) && is_numeric($id)){
			$query="SELECT a.*,group_concat(distinct(e.comp_def_assess_type)) as type,b.comp_def_name as comp_def_name,c.level_name as level_name, d.scale_name as scale_name,f.`assessment_id`,g.`assessment_pos_com_id`,g.assessment_type,g.assessment_pos_comp_id,c.level_id,d.scale_id,f.assessment_pos_id,e.comp_def_id,cat.name,cr.comp_cri_name,g.assessment_scale_id,d.scale_number,g.assessment_que_count,g.comp_per,g.pos_com_weightage FROM `uls_competency_position_requirements` a
			left join(SELECT comp_def_id,comp_def_level_ind_id,comp_def_assess_type,comp_def_assess_type_sub FROM `uls_competency_def_level_assessment` where comp_def_assess_type!='INBASKET' and comp_def_assess_type!='CASE_STUDY') e on a.comp_position_competency_id=e.comp_def_id and e.comp_def_level_ind_id=a.comp_position_level_scale_id 
			left join (select comp_def_id,comp_def_name,comp_def_category from uls_competency_definition group by comp_def_id)b on b.comp_def_id=a.comp_position_competency_id
			left join(SELECT `comp_cri_id`,`comp_cri_name` FROM `uls_competency_criticality`) cr on cr.comp_cri_id=a.comp_position_criticality_id 
			left join(SELECT `category_id`,`name` FROM `uls_category`) cat on cat.category_id=b.comp_def_category
			left join (select level_id,level_name from uls_level_master group by level_id)c on c.level_id=a.comp_position_level_id
			left join (select scale_id,scale_name,scale_number from uls_level_master_scale group by scale_id)d on d.scale_id=a.comp_position_level_scale_id
			left join (SELECT `assessment_pos_id`,`position_id`,`assessment_id` FROM `uls_assessment_position` where assessment_id=".$aid.")f on f.position_id=a.comp_position_id
			left join (SELECT `assessment_pos_comp_id`,`assessment_id`,`position_id`,`assessment_pos_id`,`assessment_pos_com_id`,`assessment_pos_level_id`,`assessment_pos_level_scale_id`,assessment_type,assessment_scale_id,assessment_que_count,comp_per,pos_com_weightage FROM `uls_assessment_competencies` where assessment_id=".$aid.")g on e.comp_def_id=g.assessment_pos_com_id and g.assessment_id=f.assessment_id and g.position_id=a.comp_position_id	
			WHERE a.`comp_position_id`=".$id."  group by e.comp_def_id order by cat.category_id,cr.comp_cri_name ASC";
			$compdef=UlsMenu::callpdo($query);
		}
		return $compdef;
	}
	
	static function self_competencypositionrequirement_details($id,$aid){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id) && is_numeric($id)){
			/* echo $query="SELECT a.*,b.comp_def_name as comp_def_name,c.level_name as level_name, d.scale_name as scale_name,f.`assessment_id`,g.`assessment_pos_com_id`,g.self_ass_comp_id,c.level_id,d.scale_id,f.assessment_pos_id,e.comp_def_id,cat.name FROM `uls_competency_position_requirements` a
			left join(SELECT comp_def_id,comp_def_level_ind_id,comp_def_assess_type,comp_def_assess_type_sub FROM `uls_competency_def_level_assessment`) e on a.comp_position_competency_id=e.comp_def_id and e.comp_def_level_ind_id=a.comp_position_level_scale_id 
			left join (select comp_def_id,comp_def_name,comp_def_category from uls_competency_definition group by comp_def_id)b on b.comp_def_id=a.comp_position_competency_id
			left join(SELECT `category_id`,`name` FROM `uls_category`) cat on cat.category_id=b.comp_def_category
			left join (select level_id,level_name from uls_level_master group by level_id)c on c.level_id=a.comp_position_level_id
			left join (select scale_id,scale_name from uls_level_master_scale group by scale_id)d on d.scale_id=a.comp_position_level_scale_id
			left join (SELECT `assessment_pos_id`,`position_id`,`assessment_id` FROM `uls_assessment_position`)f on f.position_id=a.comp_position_id
			left join (SELECT `self_ass_comp_id`,`assessment_id`,`position_id`,`assessment_pos_id`,`assessment_pos_com_id`,`assessment_pos_level_id`,`assessment_pos_level_scale_id` FROM `uls_self_assessment_competencies` where assessment_id=".$aid.")g on e.comp_def_id=g.assessment_pos_com_id and g.assessment_id=f.assessment_id and g.position_id=a.comp_position_id	
			WHERE a.`comp_position_id`=".$id."  group by e.comp_def_id order by cat.name ASC"; */
			 $query="SELECT a.*,b.comp_def_id as comp_def_id,b.comp_def_name as comp_def_name,c.level_name as level_name, d.scale_name as scale_name,f.`assessment_id`,g.`assessment_pos_com_id`,g.self_ass_comp_id,c.level_id,d.scale_id,f.assessment_pos_id,cat.name FROM `uls_competency_position_requirements` a
left join (select comp_def_id,comp_def_name,comp_def_category from uls_competency_definition group by comp_def_id)b on b.comp_def_id=a.comp_position_competency_id 
left join(SELECT `category_id`,`name` FROM `uls_category`) cat on cat.category_id=b.comp_def_category 
left join (select level_id,level_name from uls_level_master group by level_id)c on c.level_id=a.comp_position_level_id 
left join (select scale_id,scale_name from uls_level_master_scale group by scale_id)d on d.scale_id=a.comp_position_level_scale_id 
left join (SELECT `assessment_pos_id`,`position_id`,`assessment_id` FROM `uls_assessment_position`)f on f.position_id=a.comp_position_id 
left join (SELECT `self_ass_comp_id`,`assessment_id`,`position_id`,`assessment_pos_id`,`assessment_pos_com_id`,`assessment_pos_level_id`,`assessment_pos_level_scale_id` FROM `uls_self_assessment_competencies` where assessment_id=".$aid.")g on a.comp_position_competency_id=g.assessment_pos_com_id and g.assessment_id=f.assessment_id and g.position_id=a.comp_position_id WHERE a.`comp_position_id`=".$id."  GROUP BY a.comp_position_competency_id order by cat.name ASC "; 
			$compdef=UlsMenu::callpdo($query);
		}
		return $compdef;
	}
	
	static function getcompetency_position_requirement_cat($id,$cat_id,$cri_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id) && is_numeric($id)){
			 $query="select b.comp_def_id,b.comp_def_name as comp_def_name,c.level_name as level_name, d.scale_name as scale_name,d.scale_id, f.comp_cri_name,b.comp_def_category, a.* from uls_competency_position_requirements a
			left join (select comp_def_id,comp_def_name,comp_def_category from uls_competency_definition group by comp_def_id)b on b.comp_def_id=a.comp_position_competency_id
			left join (select level_id,level_name from uls_level_master group by level_id)c on c.level_id=a.comp_position_level_id
			left join (select scale_id,scale_name from uls_level_master_scale group by scale_id)d on d.scale_id=a.comp_position_level_scale_id
			left join (select comp_cri_id,comp_cri_name,comp_cri_code from uls_competency_criticality group by comp_cri_id)f on f.comp_cri_id=a.comp_position_criticality_id
			where 1 and a.comp_position_id=$id and b.comp_def_category=".$cat_id." and a.comp_position_criticality_id in (".$cri_id.") order by a.comp_position_id asc";
			$compdef=UlsMenu::callpdo($query);
		}
		return $compdef;
	}
	
	static function get_competency_position($id,$comp_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id) && is_numeric($id)){
			$query="SELECT a.*,f.comp_cri_name FROM `uls_competency_position_requirements` a
			left join (select comp_cri_id,comp_cri_name,comp_cri_code from uls_competency_criticality group by comp_cri_id)f on f.comp_cri_id=a.comp_position_criticality_id
			WHERE a.`comp_position_id`=$id and  a.comp_position_competency_id=$comp_id";
			$compdef=UlsMenu::callpdorow($query);
		}
		return $compdef;
	}
}