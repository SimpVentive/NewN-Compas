<?php

/**
 * UlsAssessmentReport
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    ##PACKAGE##
 * @subpackage ##SUBPACKAGE##
 * @author     ##NAME## <##EMAIL##>
 * @version    SVN: $Id: Builder.php 6820 2009-11-30 17:27:49Z jwage $
 */
class UlsAssessmentReport extends BaseUlsAssessmentReport
{
	function preInsert($event){
		 $CI =& get_instance();
		$CI->load->library('session');
        $this->created_by=$CI->session->userdata('username');
        $this->created_date=date('Y-m-d');
        $this->modified_by=$CI->session->userdata('username');        
        $this->modified_date=date('Y-m-d');
        $this->last_modified_by=$CI->session->userdata('user_id');
        $this->parent_org_id=$CI->session->userdata('parent_org_id');
    }
	
    function preUpdate($event){
		$CI =& get_instance();
		$CI->load->library('session');
        $this->modified_date=date('Y-m-d');
        $this->modified_by=$CI->session->userdata('username');
        $this->last_modified_by=$CI->session->userdata('user_id');
    }
	
	static function getassessment_competencies_summary($id,$pos_id,$emp_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id) && is_numeric($id)){
			$query="select b.comp_def_id, b.comp_def_name as comp_def_name,s.scale_id as req_scale_id, s.scale_name as req_scale_name,a.report_id,a.assessed_scale_id as final_scaled_id,a.development_area, a.* from uls_assessment_report a
			left join (select comp_def_id,comp_def_name from uls_competency_definition group by comp_def_id)b on b.comp_def_id=a.competency_id
			left join (select scale_id,scale_name from uls_level_master_scale group by scale_id)s on  s.scale_id=a.require_scale_id
			where 1 and a.parent_org_id=".$CI->session->userdata('parent_org_id')." and a.assessment_id=$id and a.position_id=$pos_id and a.employee_id=$emp_id and a.assessor_id=".$_SESSION['asr_id']." order by a.assessment_id asc";
			$compdef=UlsMenu::callpdo($query);
		}
		return $compdef;
	}
	
	/* static function getassessment_competencies_summary($id,$pos_id,$emp_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id) && is_numeric($id)){
			$query="select b.comp_def_id, b.comp_def_name as comp_def_name,s.scale_id as req_scale_id, s.scale_name as req_scale_name,a.report_id,a.assessed_scale_id as final_scaled_id,a.development_area, a.* from uls_assessment_competencies r
			left join (SELECT `report_id`,parent_org_id,`assessment_id`,`position_id`,`employee_id`,`assessor_id`,`competency_id`,`require_scale_id`,`assessed_scale_id`,`development_area`,`final_admin_id` FROM `uls_assessment_report` where employee_id=42 and assessor_id=150) a on a.assessment_id=r.assessment_id and a.position_id=r.position_id and r.assessment_pos_com_id=a.competency_id
			left join (select comp_def_id,comp_def_name from uls_competency_definition group by comp_def_id)b on b.comp_def_id=r.assessment_pos_com_id
			left join (select scale_id,scale_name from uls_level_master_scale group by scale_id)s on  s.scale_id=r.assessment_pos_level_scale_id
			where 1 and r.parent_org_id=3 and r.assessment_id=1 and r.position_id=9 order by r.assessment_id asc";
			$compdef=UlsMenu::callpdo($query);
		}
		return $compdef;
	} */
	
	static function getassessment_assessor_name($id,$pos_id,$emp_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id) && is_numeric($id)){
			$query="select distinct(a.assessor_id) as ass_id,c.assessor_name,a.assessment_id,a.position_id,a.employee_id from uls_assessment_report a
			left join(SELECT `assessor_id` FROM `uls_assessment_position_assessor`) b on a.assessor_id=b.assessor_id
			left join(SELECT `assessor_id`,`assessor_name` FROM `uls_assessor_master`) c on c.assessor_id=b.assessor_id
			where 1 and a.parent_org_id=".$CI->session->userdata('parent_org_id')." and a.assessment_id=$id and a.position_id=$pos_id and a.employee_id=$emp_id and a.assessor_id is not NULL  order by a.assessment_id asc";
			$compdef=UlsMenu::callpdo($query);
		}
		return $compdef;
	}
	
	static function getassessment_admin_summary($id,$pos_id,$emp_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id) && is_numeric($id)){
			$ss=!empty($emp_id)?"and a.employee_id=$emp_id":"";
			$query="select b.comp_def_id, b.comp_def_name as comp_def_name,s.scale_id as req_scale_id, s.scale_name as req_scale_name,a.report_id,a.assessed_scale_id as final_scaled_id,ass.scale_name as final_scaled_name,a.development_area,ct.comp_cri_name,ct.comp_rating_value,s.scale_number as req_scale,ass.scale_number as ass_scale,b.comp_def_short_desc,l.level_scale,ct.comp_cri_code, a.* from uls_assessment_report a
			left join (select comp_def_id,comp_def_name,comp_def_short_desc from uls_competency_definition group by comp_def_id)b on b.comp_def_id=a.competency_id
			left join(SELECT `comp_position_id`,`comp_position_competency_id`,`comp_position_criticality_id` FROM `uls_competency_position_requirements`) c on c.comp_position_id=a.position_id and c.comp_position_competency_id=a.competency_id
			left join(SELECT `comp_cri_id`,`comp_cri_name`,comp_rating_value,comp_cri_code FROM `uls_competency_criticality`) ct on ct.comp_cri_id=c.comp_position_criticality_id
			left join (select scale_id,scale_name,scale_number,level_id from uls_level_master_scale group by scale_id)s on s.scale_id=a.require_scale_id
			left join(SELECT `level_id`,`level_scale` FROM `uls_level_master`) l on l.level_id=s.level_id
			left join (select scale_id,scale_name,scale_number from uls_level_master_scale group by scale_id)ass on ass.scale_id=a.assessed_scale_id
			where 1 and a.parent_org_id=".$CI->session->userdata('parent_org_id')." and a.assessment_id=$id and a.position_id=$pos_id $ss and a.assessor_id is not NULL order by a.assessment_id asc";
			$compdef=UlsMenu::callpdo($query);
		}
		return $compdef;
	}
	
	static function getassessment_admin_competency($id,$pos_id,$cat_id=""){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id) && is_numeric($id)){	
			$catid=!empty($cat_id)?" and b.comp_def_category=".$cat_id."":"";
			$query="SELECT b.comp_def_id, b.comp_def_name as comp_def_name,s.scale_id as req_scale_id, s.scale_name as req_scale_name,ct.comp_cri_name,ct.comp_rating_value,s.scale_number as req_scale,b.comp_def_short_desc,l.level_scale,ct.comp_cri_code,ca.name,b.comp_def_name_alt,a.* FROM `uls_assessment_competencies` a
			left join (select comp_def_id,comp_def_name,comp_def_short_desc,`comp_def_category`,comp_def_name_alt from uls_competency_definition group by comp_def_id)b on b.comp_def_id=a.assessment_pos_com_id
			left join(SELECT `category_id`,`name` FROM `uls_category`) ca on b.comp_def_category=ca.category_id
			left join(SELECT `comp_position_id`,`comp_position_competency_id`,`comp_position_criticality_id` FROM `uls_competency_position_requirements`) c on c.comp_position_id=a.position_id and c.comp_position_competency_id=a.assessment_pos_com_id
			left join(SELECT `comp_cri_id`,`comp_cri_name`,comp_rating_value,comp_cri_code FROM `uls_competency_criticality`) ct on ct.comp_cri_id=c.comp_position_criticality_id left join (select scale_id,scale_name,scale_number,level_id from uls_level_master_scale group by scale_id)s on s.scale_id=a.assessment_pos_level_scale_id
			left join(SELECT `level_id`,`level_scale` FROM `uls_level_master`) l on l.level_id=a.assessment_pos_level_id
			where 1 and a.parent_org_id=".$CI->session->userdata('parent_org_id')." and a.assessment_id=$id and a.position_id=$pos_id $catid order by a.assessment_id,ct.comp_cri_name asc";
			$compdef=UlsMenu::callpdo($query);
		}
		return $compdef;
	}
	
	static function getadminassessment_competencies_summary($id,$pos_id,$emp_id,$assessor_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id) && is_numeric($id)){
			$query="select b.comp_def_id, b.comp_def_name as comp_def_name,s.scale_id as req_scale_id, s.scale_name as req_scale_name,a.report_id,a.assessed_scale_id as final_scaled_id,a.development_area, a.*,os.scale_name as as_scale_name from uls_assessment_report a
			left join (select comp_def_id,comp_def_name from uls_competency_definition group by comp_def_id)b on b.comp_def_id=a.competency_id
			left join (select scale_id,scale_name from uls_level_master_scale group by scale_id)s on s.scale_id=a.require_scale_id
			left join (select scale_id,scale_name from uls_level_master_scale group by scale_id)os on os.scale_id=a.assessed_scale_id
			where 1 and a.parent_org_id=".$CI->session->userdata('parent_org_id')." and a.assessment_id=$id and a.position_id=$pos_id and a.employee_id=$emp_id and a.assessor_id=".$assessor_id." order by a.assessment_id asc";
			$compdef=UlsMenu::callpdo($query);
		}
		return $compdef;
	}
	
	static function getadminassessment_competencies_insert($id,$pos_id,$emp_id,$assessor_id,$comp_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id) && is_numeric($id)){
			//and a.final_admin_id=".$assessor_id."
			$query="select a.* from uls_assessment_report a
			where 1 and a.parent_org_id=".$CI->session->userdata('parent_org_id')." and a.assessment_id=$id and a.position_id=$pos_id and a.employee_id=$emp_id and competency_id=$comp_id  order by a.assessment_id asc";
			$compdef=UlsMenu::callpdorow($query);
		}
		return $compdef;
	}
	
	
	
	static function getadminassessment_com_insert($id,$pos_id,$emp_id,$assessor_id,$comp_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id) && is_numeric($id)){
			$query="select a.* from uls_assessment_report a
			where 1 and a.parent_org_id=".$CI->session->userdata('parent_org_id')." and a.assessment_id=$id and a.position_id=$pos_id and a.employee_id=$emp_id and competency_id=$comp_id and a.assessor_id=".$assessor_id." order by a.assessment_id asc";
			$compdef=UlsMenu::callpdorow($query);
		}
		return $compdef;
	}
	
	static function getassessment_competencies_summary_report($id,$pos_id,$emp_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id) && is_numeric($id)){
			$query="select b.comp_def_id, b.comp_def_name as comp_def_name,s.scale_id as req_scale_id, s.scale_name as req_scale_name,a.report_id,a.assessed_scale_id as final_scaled_id,a.development_area as dev_area, a.* from uls_assessment_report a
			left join (select comp_def_id,comp_def_name from uls_competency_definition group by comp_def_id)b on b.comp_def_id=a.competency_id
			left join (select scale_id,scale_name from uls_level_master_scale group by scale_id)s on  s.scale_id=a.require_scale_id
			where 1 and a.parent_org_id=".$CI->session->userdata('parent_org_id')." and a.assessment_id=$id and a.position_id=$pos_id and a.employee_id=$emp_id order by a.assessment_id asc";
			$compdef=UlsMenu::callpdo($query);
		}
		return $compdef;
	}
	
	static function admin_assessment_competencies_report($id,$pos_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id) && is_numeric($id)){
			$query="select b.comp_def_id, b.comp_def_name as comp_def_name,s.scale_id as req_scale_id, s.scale_name as req_scale_name,a.report_id,a.assessed_scale_id as final_scaled_id,a.development_area as dev_area, a.* from uls_assessment_report a
			left join (select comp_def_id,comp_def_name from uls_competency_definition group by comp_def_id)b on b.comp_def_id=a.competency_id
			left join (select scale_id,scale_name from uls_level_master_scale group by scale_id)s on  s.scale_id=a.require_scale_id
			where 1 and a.parent_org_id=".$CI->session->userdata('parent_org_id')." and a.assessment_id=$id and a.position_id=$pos_id  group by a.competency_id";
			$compdef=UlsMenu::callpdo($query);
		}
		return $compdef;
	}
	
	static function admin_position_competency_level($id,$pos_id,$comp_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id)){
		$query="SELECT a.`assessment_pos_comp_id`,a.`assessment_pos_level_scale_id`,s.scale_number,s.scale_name FROM `uls_assessment_competencies` a
		left join (select scale_id,scale_name,scale_number from uls_level_master_scale group by scale_id)s on  s.scale_id=a.assessment_pos_level_scale_id
		WHERE a.`assessment_id`=".$id." and a.`position_id`=".$pos_id." and a.`assessment_pos_com_id`=".$comp_id; 
		$compdef=UlsMenu::callpdorow($query);
		}
		return $compdef;
	}
	
	static function admin_position_assessed_competency_level_interview($id,$pos_id,$comp_id,$emp_id,$scale_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id)){
		$query="SELECT avg(sa.scale_number) as ass_ave,ar.employee_id FROM `uls_assessment_report_bytype` ar 
		left join (select scale_id,scale_name,scale_number from uls_level_master_scale group by scale_id)sa on  sa.scale_id=ar.assessed_scale_id
		WHERE ar.`assessment_id`=".$id." and ar.`position_id`=".$pos_id." and ar.`employee_id`=".$emp_id." and ar.`competency_id`=".$comp_id." and ar.`assessment_type`='INTERVIEW' and ar.require_scale_id=".$scale_id." and  ar.assessed_scale_id is NOT NULL group by ar.employee_id"; 
		$compdef=UlsMenu::callpdorow($query);
		}
		return $compdef;
	}
	
	static function admin_position_assessed_competency_level_test_new($id,$pos_id,$comp_id,$emp_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id)){
		$query="SELECT avg(sa.scale_number) as ass_ave,ar.employee_id FROM `uls_assessment_report_bytype` ar 
		left join (select scale_id,scale_name,scale_number from uls_level_master_scale group by scale_id)sa on  sa.scale_id=ar.assessed_scale_id
		WHERE ar.`assessment_id`=".$id." and ar.`position_id`=".$pos_id." and ar.`employee_id`=".$emp_id." and ar.`competency_id`=".$comp_id." and ar.`assessment_type`='TEST' and  ar.assessed_scale_id is NOT NULL group by ar.employee_id"; 
		$compdef=UlsMenu::callpdorow($query);
		}
		return $compdef;
	}
	
	static function admin_position_assessed_competency_level_test($id,$pos_id,$comp_id,$emp_id,$scale_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id)){
		$query="SELECT avg(sa.scale_number) as ass_ave,ar.employee_id FROM `uls_assessment_report_bytype` ar 
		left join (select scale_id,scale_name,scale_number from uls_level_master_scale group by scale_id)sa on  sa.scale_id=ar.assessed_scale_id
		WHERE ar.`assessment_id`=".$id." and ar.`position_id`=".$pos_id." and ar.`employee_id`=".$emp_id." and ar.`competency_id`=".$comp_id." and ar.`assessment_type`='TEST' and ar.require_scale_id=".$scale_id." and  ar.assessed_scale_id is NOT NULL group by ar.employee_id"; 
		$compdef=UlsMenu::callpdorow($query);
		}
		return $compdef;
	}
	
	static function admin_position_assessed_competency_level_inbasket($id,$pos_id,$comp_id,$emp_id,$scale_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id)){
		$query="SELECT avg(sa.scale_number) as ass_ave,ar.employee_id FROM `uls_assessment_report_bytype` ar 
		left join (select scale_id,scale_name,scale_number from uls_level_master_scale group by scale_id)sa on  sa.scale_id=ar.assessed_scale_id
		WHERE ar.`assessment_id`=".$id." and ar.`position_id`=".$pos_id." and ar.`employee_id`=".$emp_id." and ar.`competency_id`=".$comp_id." and ar.`assessment_type`='INBASKET' and ar.require_scale_id=".$scale_id." and  ar.assessed_scale_id is NOT NULL group by ar.employee_id"; 
		$compdef=UlsMenu::callpdorow($query);
		}
		return $compdef;
	}
	
	static function admin_position_assessed_competency_level_inbasket_new($id,$pos_id,$comp_id,$emp_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id)){
		$query="SELECT avg(sa.scale_number) as ass_ave,ar.employee_id FROM `uls_assessment_report_bytype` ar 
		left join (select scale_id,scale_name,scale_number from uls_level_master_scale group by scale_id)sa on  sa.scale_id=ar.assessed_scale_id
		WHERE ar.`assessment_id`=".$id." and ar.`position_id`=".$pos_id." and ar.`employee_id`=".$emp_id." and ar.`competency_id`=".$comp_id." and ar.`assessment_type`='INBASKET' and  ar.assessed_scale_id is NOT NULL group by ar.employee_id"; 
		$compdef=UlsMenu::callpdorow($query);
		}
		return $compdef;
	}
	
	static function admin_position_assessed_competency_level_case($id,$pos_id,$comp_id,$emp_id,$scale_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id)){
		$query="SELECT avg(sa.scale_number) as ass_ave,ar.employee_id FROM `uls_assessment_report_bytype` ar 
		left join (select scale_id,scale_name,scale_number from uls_level_master_scale group by scale_id)sa on  sa.scale_id=ar.assessed_scale_id
		WHERE ar.`assessment_id`=".$id." and ar.`position_id`=".$pos_id." and ar.`employee_id`=".$emp_id." and ar.`competency_id`=".$comp_id." and ar.`assessment_type`='CASE_STUDY' and ar.require_scale_id=".$scale_id." and  ar.assessed_scale_id is NOT NULL group by ar.employee_id"; 
		$compdef=UlsMenu::callpdorow($query);
		}
		return $compdef;
	}
	
	static function admin_position_assessed_competency_level_case_new($id,$pos_id,$comp_id,$emp_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id)){
		$query="SELECT avg(sa.scale_number) as ass_ave,ar.employee_id FROM `uls_assessment_report_bytype` ar 
		left join (select scale_id,scale_name,scale_number from uls_level_master_scale group by scale_id)sa on  sa.scale_id=ar.assessed_scale_id
		WHERE ar.`assessment_id`=".$id." and ar.`position_id`=".$pos_id." and ar.`employee_id`=".$emp_id." and ar.`competency_id`=".$comp_id." and ar.`assessment_type`='CASE_STUDY' and  ar.assessed_scale_id is NOT NULL group by ar.employee_id"; 
		$compdef=UlsMenu::callpdorow($query);
		}
		return $compdef;
	}
	
	static function admin_position_assessed_competency_level($id,$pos_id,$comp_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id)){
		$query="SELECT avg(sa.scale_number) as ass_ave,ar.employee_id FROM `uls_assessment_report` ar 
		left join (select scale_id,scale_name,scale_number from uls_level_master_scale group by scale_id)sa on  sa.scale_id=ar.assessed_scale_id
		WHERE ar.`assessment_id` in (".$id.") and ar.`position_id`=".$pos_id." and ar.`competency_id`=".$comp_id." and  ar.assessed_scale_id is NOT NULL group by ar.employee_id"; 
		$compdef=UlsMenu::callpdo($query);
		}
		return $compdef;
	}
	
	
	static function competency_analysis_data($comp_id,$scale_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		
		$query="SELECT avg(sa.scale_number) as ass_ave FROM `uls_assessment_report` ar 
		left join (select scale_id,scale_name,scale_number from uls_level_master_scale group by scale_id)sa on  sa.scale_id=ar.assessed_scale_id
		WHERE ar.`competency_id`=".$comp_id." and ar.`require_scale_id`=".$scale_id." and ar.assessed_scale_id is NOT NULL group by ar.competency_id"; 
		$compdef=UlsMenu::callpdorow($query);
		
		$query_question="SELECT count(c.`user_test_question_id`) as qua_total FROM `uls_assessment_test_questions` a
		left join(SELECT `question_id`,`scale_id`,`question_bank_id` FROM `uls_questions`) b on b.question_id=a.question_id
		left join(SELECT `user_test_question_id`,`correct_flag` FROM `uls_utest_responses_assessment`) c on c.user_test_question_id=b.question_id
		where a.`competency_id`=".$comp_id." and b.scale_id=".$scale_id."";
		$queryquestiont=UlsMenu::callpdorow($query_question);
		
		$query_question_correct="SELECT count(c.`user_test_question_id`) as cor_total FROM `uls_assessment_test_questions` a
		left join(SELECT `question_id`,`scale_id`,`question_bank_id` FROM `uls_questions`) b on b.question_id=a.question_id
		left join(SELECT `user_test_question_id`,`correct_flag` FROM `uls_utest_responses_assessment`) c on c.user_test_question_id=b.question_id
		where a.`competency_id`=".$comp_id." and b.scale_id=".$scale_id." and c.`correct_flag`='C'";
		$queryquestionc=UlsMenu::callpdorow($query_question_correct);
		
		$query_question_wrong="SELECT count(c.`user_test_question_id`) as wro_total FROM `uls_assessment_test_questions` a
		left join(SELECT `question_id`,`scale_id`,`question_bank_id` FROM `uls_questions`) b on b.question_id=a.question_id
		left join(SELECT `user_test_question_id`,`correct_flag` FROM `uls_utest_responses_assessment`) c on c.user_test_question_id=b.question_id
		where a.`competency_id`=".$comp_id." and b.scale_id=".$scale_id." and c.`correct_flag`='W'";
		$queryquestionw=UlsMenu::callpdorow($query_question_wrong);
		
		echo "<div>
			<span class='pull-left inline-block capitalize-font txt-dark'>
				Average Assessed Value
			</span>
			<span class='label label-warning pull-right'>".round($compdef['ass_ave'],2)."</span>
			<div class='clearfix'></div>
			<hr class='light-grey-hr row mt-10 mb-10'>
			<span class='pull-left inline-block capitalize-font txt-dark'>
				Total Questions
			</span>
			<span class='label label-danger pull-right'>".$queryquestiont['qua_total']."</span>
			<div class='clearfix'></div>
			<hr class='light-grey-hr row mt-10 mb-10'>
			<span class='pull-left inline-block capitalize-font txt-dark'>
				MCQ Analysis - Correct
			</span>
			<span class='label label-success pull-right'>".round((($queryquestionc['cor_total']/$queryquestiont['qua_total'])*100),2)."%</span>
			<div class='clearfix'></div>
			<hr class='light-grey-hr row mt-10 mb-10'>
			<span class='pull-left inline-block capitalize-font txt-dark'>
				MCQ Analysis - Wrong
			</span>
			<span class='label label-primary pull-right'>".round((($queryquestionw['wro_total']/$queryquestiont['qua_total'])*100),2)."%</span>
			<div class='clearfix'></div>
		</div>";
	}
	
	static function admin_position_assessed_competency_level_test_report($id,$pos_id,$comp_id,$scale_id,$emp_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id)){
		$query="SELECT avg(sa.scale_number) as ass_ave,ar.employee_id FROM `uls_assessment_report_bytype` ar 
		left join (select scale_id,scale_name,scale_number from uls_level_master_scale group by scale_id)sa on  sa.scale_id=ar.assessed_scale_id
		WHERE ar.`assessment_id`=".$id." and ar.`position_id`=".$pos_id." and ar.`employee_id`=".$emp_id." and ar.`competency_id`=".$comp_id." and ar.require_scale_id=".$scale_id." and ar.`assessment_type`='TEST' and  ar.assessed_scale_id is NOT NULL group by ar.employee_id"; 
		$compdef=UlsMenu::callpdorow($query);
		}
		return $compdef;
	}
	
	static function admin_position_assessed_competency_level_inbasket_report($id,$pos_id,$comp_id,$scale_id,$emp_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id)){
		$query="SELECT avg(sa.scale_number) as ass_ave,ar.employee_id FROM `uls_assessment_report_bytype` ar 
		left join (select scale_id,scale_name,scale_number from uls_level_master_scale group by scale_id)sa on  sa.scale_id=ar.assessed_scale_id
		WHERE ar.`assessment_id`=".$id." and ar.`position_id`=".$pos_id." and ar.`employee_id`=".$emp_id." and ar.`competency_id`=".$comp_id." and ar.require_scale_id=".$scale_id." and ar.`assessment_type`='INBASKET' and  ar.assessed_scale_id is NOT NULL group by ar.employee_id"; 
		$compdef=UlsMenu::callpdorow($query);
		}
		return $compdef;
	}
	
	static function admin_position_assessed_competency_level_case_report($id,$pos_id,$comp_id,$scale_id,$emp_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id)){
		$query="SELECT avg(sa.scale_number) as ass_ave,ar.employee_id FROM `uls_assessment_report_bytype` ar 
		left join (select scale_id,scale_name,scale_number from uls_level_master_scale group by scale_id)sa on  sa.scale_id=ar.assessed_scale_id
		WHERE ar.`assessment_id`=".$id." and ar.`position_id`=".$pos_id." and ar.`employee_id`=".$emp_id." and ar.`competency_id`=".$comp_id." and ar.require_scale_id=".$scale_id." and ar.`assessment_type`='CASE_STUDY' and  ar.assessed_scale_id is NOT NULL group by ar.employee_id"; 
		$compdef=UlsMenu::callpdorow($query);
		}
		return $compdef;
	}
	
	static function admin_position_assessed_competency_level_report($id,$pos_id,$comp_id,$scale_id,$emp_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id)){
		$query="SELECT avg(sa.scale_number) as ass_ave,ar.employee_id FROM `uls_assessment_report` ar 
		left join (select scale_id,scale_name,scale_number from uls_level_master_scale group by scale_id)sa on  sa.scale_id=ar.assessed_scale_id
		WHERE ar.`assessment_id` in (".$id.") and ar.`position_id`=".$pos_id." and ar.`competency_id`=".$comp_id." and ar.`employee_id`=".$emp_id." and ar.require_scale_id=".$scale_id." and  ar.assessed_scale_id is NOT NULL group by ar.employee_id"; 
		$compdef=UlsMenu::callpdorow($query);
		}
		return $compdef;
	}
	
	static function admin_position_report($id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id)){
		$query="SELECT ar.* FROM `uls_assessment_report` ar
		WHERE ar.`report_id`=".$id; 
		$compdef=UlsMenu::callpdorow($query);
		}
		return $compdef;
	}
}