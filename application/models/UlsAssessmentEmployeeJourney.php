<?php

/**
 * UlsAssessmentEmployeeJourney
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    ##PACKAGE##
 * @subpackage ##SUBPACKAGE##
 * @author     ##NAME## <##EMAIL##>
 * @version    SVN: $Id: Builder.php 6820 2009-11-30 17:27:49Z jwage $
 */
class UlsAssessmentEmployeeJourney extends BaseUlsAssessmentEmployeeJourney
{
	function preInsert($event){
		$CI =& get_instance();
		$CI->load->library('session');
        $this->created_by=$CI->session->userdata('username');
        $this->created_date=date('Y-m-d');
        $this->modified_by=$CI->session->userdata('username');        
        $this->modified_date=date('Y-m-d');
        $this->last_modified_by=$CI->session->userdata('user_id');
        $this->parent_org_id=$CI->session->userdata('parent_org_id');
    }
	
    function preUpdate($event){
		$CI =& get_instance();
		$CI->load->library('session');
        $this->modified_date=date('Y-m-d');
        $this->modified_by=$CI->session->userdata('username');
        $this->last_modified_by=$CI->session->userdata('user_id');
    }
	
	static function get_assessment_employees($ass_id,$pos_id,$emp_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($ass_id) && is_numeric($ass_id)){
			$query="select a.* from uls_assessment_employee_journey a
			where 1 and a.parent_org_id=".$CI->session->userdata('parent_org_id')." and a.assessment_id=$ass_id and a.position_id=$pos_id and a.employee_id=$emp_id";
			$compdef=UlsMenu::callpdo($query);
		}
		return $compdef;
	}
	
	static function get_pos_validation_employees($val_id,$pos_id,$emp_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($val_id) && is_numeric($val_id)){
			$query="select a.* from uls_assessment_employee_journey a
			where 1 and a.parent_org_id=".$CI->session->userdata('parent_org_id')." and a.val_id=$val_id and a.position_id=$pos_id and a.employee_id=$emp_id";
			$compdef=UlsMenu::callpdorow($query);
		}
		return $compdef;
	}
	
	static function get_employees_details($id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($id) && is_numeric($id)){
			$query="select a.* from uls_assessment_employee_journey a
			where 1 and a.parent_org_id=".$CI->session->userdata('parent_org_id')." and a.id=$id";
			$compdef=UlsMenu::callpdorow($query);
		}
		return $compdef;
	}
	
	static function get_assessment_employees_tna($ass_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($ass_id) && is_numeric($ass_id)){
			$query="select e.`employee_number`,e.`full_name`,e.`position_name`,e.`location_name`,p.`position_name` as ass_position_name,a.* from uls_assessment_employee_journey a
			left join(SELECT `employee_id`,`location_id`,`assessment_id`,`position_id`,tna_status FROM `uls_assessment_employees`) i on a.employee_id=i.employee_id and a.assessment_id=i.assessment_id and a.position_id=i.position_id
			left join(SELECT `employee_id`,`employee_number`,`full_name`,`position_name`,`location_name` FROM `employee_data`) e on e.employee_id=a.employee_id
			left join(SELECT `position_id`,`position_name` FROM `uls_position`) p on p.position_id=a.position_id
			where 1 and  a.parent_org_id=".$CI->session->userdata('parent_org_id')." and i.tna_status='Y' and a.assessment_id=$ass_id and a.tni_status=1";
			$compdef=UlsMenu::callpdo($query);
		}
		return $compdef;
	}
	
	static function get_assessment_tna_employees($ass_id,$pos_id,$emp_id){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		if(!empty($ass_id) && is_numeric($ass_id)){
			$query="select a.* from uls_assessment_employee_journey a
			where 1 and a.parent_org_id=".$CI->session->userdata('parent_org_id')." and a.assessment_id=$ass_id and a.position_id=$pos_id and a.employee_id=$emp_id";
			$compdef=UlsMenu::callpdorow($query);
		}
		return $compdef;
	}
	
	/* static function get_assessment_atri_tna($loc_id="",$org_id="",$type_id=""){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		$sq=!empty($loc_id)? " and e.location_id='$loc_id'":"";
		$sq.=!empty($org_id)? " and e.org_id='$org_id'":"";
		$type_data=!empty($type_id)?($type_id==1?" and a.tni_status=1":" and a.tni_status is NULL"):"and a.tni_status=1";
		$query="select e.`employee_number`,e.`full_name`,e.`position_name`,e.org_name,e.`location_name`,p.`position_name` as ass_position_name,a.* from uls_assessment_employee_journey a
		left join(SELECT `employee_id`,`location_id`,`assessment_id`,`position_id`,tna_status FROM `uls_assessment_employees`) i on a.employee_id=i.employee_id and a.assessment_id=i.assessment_id and a.position_id=i.position_id
		left join(SELECT `employee_id`,`employee_number`,`full_name`,`position_name`,`location_name`,location_id,org_id,org_name FROM `employee_data`) e on e.employee_id=a.employee_id
		left join(SELECT `position_id`,`position_name` FROM `uls_position`) p on p.position_id=a.position_id
		where 1 and  a.parent_org_id=".$CI->session->userdata('parent_org_id')." and i.tna_status='Y' ".$type_data." ".$sq." group by i.employee_id order by e.`full_name` ASC";
		$compdef=UlsMenu::callpdo($query);
		return $compdef;
	} */
	
	static function get_assessment_atri_tna($loc_id="",$org_id="",$comp_def_id="",$comp_def_pro_id="",$type_id=""){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		$sq=!empty($loc_id)? " and a.location_id='$loc_id'":"";
		$sq.=!empty($org_id)? " and a.org_id='$org_id'":"";
		$sq.=!empty($comp_def_id)? " and c.comp_def_id='$comp_def_id'":"";
		$sq.=!empty($comp_def_pro_id)? " and p.comp_def_pro_id='$comp_def_pro_id'":"";
		$type_data=!empty($type_id)?($type_id==1?" and e.tni_status=1":" and e.tni_status is NULL"):" and e.tni_status=1";
		$query="SELECT b.`employee_id`,b.`employee_number`,b.`full_name`,b.org_name,b.position_name,b.location_name,a.`assessment_id`,a.`position_id`,b.email FROM `uls_assessment_employees` a 
		left join(SELECT `employee_id`,`tni_status`,assessment_id,position_id FROM `uls_assessment_employee_journey`) e on e.employee_id=a.employee_id and a.assessment_id=e.assessment_id and a.position_id=e.position_id
		left join(SELECT `assessment_id`,`position_id`,`employee_id`,`comp_def_id` FROM `uls_assessment_employee_dev_competencies`) c on c.employee_id=a.employee_id and a.assessment_id=c.assessment_id and a.position_id=c.position_id
		left join(SELECT `assessment_id`,`position_id`,`employee_id`,`comp_def_pro_id` FROM `uls_assessment_employee_select_programs`) p on p.employee_id=a.employee_id and a.assessment_id=c.assessment_id and a.position_id=c.position_id
		left join(SELECT `employee_id`,`employee_number`,`full_name`,org_name,position_name,location_name,email FROM `employee_data` ) b on a.employee_id=b.employee_id
		WHERE a.`parent_org_id`=".$CI->session->userdata('parent_org_id')." and a.tna_status='Y' ".$type_data." ".$sq." group by a.employee_id order by b.`full_name` ASC";
		$compdef=UlsMenu::callpdo($query);
		return $compdef;
	}
	
	static function get_assessment_atri_tnanew($loc_id="",$org_id="",$comp_def_id="",$comp_def_pro_id="",$type_id=""){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		$sq=!empty($loc_id)? " and a.location_id='$loc_id'":"";
		$sq.=!empty($org_id)? " and a.org_id='$org_id'":"";
		$sq.=!empty($comp_def_id)? " and p.comp_def_id='$comp_def_id'":"";
		$sq.=!empty($comp_def_pro_id)? " and trim(be.program_name)='".$comp_def_pro_id."'":"";
		$type_data=!empty($type_id)?($type_id==1? " and e.tni_status=1":" and e.tni_status is NULL"):" and e.tni_status=1";
		$query="SELECT be.program_name,ce.comp_def_name,p.tna_year,b.`employee_id`,b.`employee_number`,b.`full_name`,b.org_name,b.position_name,b.location_name,b.grade_name,a.`assessment_id`,a.`position_id`,i.comp_def_level_ind_name,b.email FROM `uls_assessment_employees` a 
		left join(SELECT `employee_id`,`tni_status`,assessment_id,position_id FROM `uls_assessment_employee_journey`) e on e.employee_id=a.employee_id and a.assessment_id=e.assessment_id and a.position_id=e.position_id
		left join(SELECT `assessment_id`,`position_id`,`employee_id`,`comp_def_id` FROM `uls_assessment_employee_dev_competencies`) c on c.employee_id=a.employee_id and a.assessment_id=c.assessment_id and a.position_id=c.position_id
		left join(SELECT `assessment_id`,`position_id`,`employee_id`,`comp_def_pro_id`,tna_year,comp_def_id FROM `uls_assessment_employee_select_programs`) p on p.employee_id=a.employee_id and a.assessment_id=c.assessment_id and a.position_id=c.position_id
		left join(SELECT `comp_def_pro_id`,`comp_def_level_ind_id`,`comp_def_id`,`comp_def_level_id`,`program_name` FROM `uls_competency_def_level_indicator_programs`) be on be.comp_def_pro_id=p.comp_def_pro_id
		left join(SELECT `comp_def_id`,`comp_def_name` FROM `uls_competency_definition`) ce on ce.comp_def_id=p.comp_def_id
		left join(SELECT `comp_def_level_ind_id`,`comp_def_level_id`,`comp_def_level_ind_name` FROM `uls_competency_def_level_indicator`) i on i.comp_def_level_ind_id=be.comp_def_level_ind_id
		left join(SELECT `scale_id`,`scale_name`,level_id,scale_number FROM `uls_level_master_scale`) se on se.scale_id=be.comp_def_level_id
		left join(SELECT `employee_id`,`employee_number`,`full_name`,org_name,position_name,location_name,grade_name,email FROM `employee_data` ) b on a.employee_id=b.employee_id
		WHERE a.`parent_org_id`=".$CI->session->userdata('parent_org_id')." and a.tna_status='Y' and a.location_id is not NULL ".$type_data." ".$sq." group by a.employee_id,be.program_name,ce.comp_def_name order by b.employee_number,be.`program_name` asc,ce.comp_def_name ASC";
		$compdef=UlsMenu::callpdo($query);
		return $compdef;
	}
	
	static function get_assessment_atri_tna_report($loc_id="",$org_id="",$emp_id=""){
		$CI =& get_instance();
		$CI->load->library('session');
		$compdef=array();
		$sq=!empty($loc_id)? " and a.location_id='$loc_id'":"";
		$sq.=!empty($org_id)? " and a.org_id='$org_id'":"";
		$sq.=!empty($emp_id)? " and a.employee_id='$emp_id'":"";
		$query="SELECT be.program_name,ce.comp_def_name,p.tna_year,b.`employee_id`,b.`employee_number`,b.`full_name`,b.org_name,b.position_name,b.location_name,b.grade_name,a.`assessment_id`,a.`position_id`,i.comp_def_level_ind_name FROM `uls_assessment_employees` a 
		left join(SELECT `employee_id`,`tni_status`,assessment_id,position_id FROM `uls_assessment_employee_journey`) e on e.employee_id=a.employee_id and a.assessment_id=e.assessment_id and a.position_id=e.position_id
		left join(SELECT `assessment_id`,`position_id`,`employee_id`,`comp_def_id` FROM `uls_assessment_employee_dev_competencies`) c on c.employee_id=a.employee_id and a.assessment_id=c.assessment_id and a.position_id=c.position_id
		left join(SELECT `assessment_id`,`position_id`,`employee_id`,`comp_def_pro_id`,tna_year,comp_def_id FROM `uls_assessment_employee_select_programs`) p on p.employee_id=a.employee_id and a.assessment_id=c.assessment_id and a.position_id=c.position_id
		left join(SELECT `comp_def_pro_id`,`comp_def_level_ind_id`,`comp_def_id`,`comp_def_level_id`,`program_name` FROM `uls_competency_def_level_indicator_programs`) be on be.comp_def_pro_id=p.comp_def_pro_id
		left join(SELECT `comp_def_id`,`comp_def_name` FROM `uls_competency_definition`) ce on ce.comp_def_id=p.comp_def_id
		left join(SELECT `comp_def_level_ind_id`,`comp_def_level_id`,`comp_def_level_ind_name` FROM `uls_competency_def_level_indicator`) i on i.comp_def_level_ind_id=be.comp_def_level_ind_id
		left join(SELECT `scale_id`,`scale_name`,level_id,scale_number FROM `uls_level_master_scale`) se on se.scale_id=be.comp_def_level_id
		left join(SELECT `employee_id`,`employee_number`,`full_name`,org_name,position_name,location_name,grade_name FROM `employee_data` ) b on a.employee_id=b.employee_id
		WHERE a.`parent_org_id`=".$CI->session->userdata('parent_org_id')." and a.tna_status='Y' and a.location_id is not NULL and e.tni_status=1 ".$sq." group by a.employee_id,be.program_name,ce.comp_def_name order by b.employee_number,be.`program_name` asc,ce.comp_def_name ASC";
		$compdef=UlsMenu::callpdo($query);
		return $compdef;
	}
}